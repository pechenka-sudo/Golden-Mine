<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Golden Mine — Игра с авторизацией</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #f0e68c, #daa520);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #4b3b00;
      user-select: none;
    }
    #app {
      background: #fff8dc;
      border-radius: 20px;
      width: 360px;
      box-shadow: 0 10px 30px rgba(184, 134, 11, 0.4);
      overflow: hidden;
      padding: 30px 30px 60px;
    }
    h1 {
      margin: 0 0 20px;
      font-weight: 700;
      font-size: 26px;
      color: #b8860b;
      text-align: center;
      text-shadow: 0 0 5px #ffd700;
    }
    /* Вкладки */
    .tabs {
      display: flex;
      border-radius: 50px;
      overflow: hidden;
      box-shadow: inset 0 0 8px #b8860b;
      margin-bottom: 25px;
      user-select: none;
      cursor: pointer;
    }
    .tab {
      flex: 1;
      padding: 12px 0;
      background: #fff3b0;
      color: #6b4f00;
      font-weight: 600;
      text-align: center;
      transition: background 0.3s, color 0.3s;
      border-bottom: 4px solid transparent;
      font-size: 16px;
      letter-spacing: 0.05em;
    }
    .tab.active {
      background: #b8860b;
      color: white;
      border-bottom: 4px solid #ffd700;
      text-shadow: 0 0 8px #ffd700;
    }
    /* Формы */
    form {
      display: none;
      flex-direction: column;
      gap: 18px;
      animation: fadeIn 0.5s ease forwards;
    }
    form.active {
      display: flex;
    }
    input[type="email"],
    input[type="password"],
    input[type="text"] {
      padding: 12px 14px;
      font-size: 16px;
      border: 2px solid #b8860b;
      border-radius: 10px;
      outline-offset: 2px;
      outline-color: #ffd700;
      transition: border-color 0.3s;
      font-family: 'Montserrat', sans-serif;
      color: #4b3b00;
    }
    input[type="email"]:focus,
    input[type="password"]:focus,
    input[type="text"]:focus {
      border-color: #ffdb58;
      box-shadow: 0 0 8px #ffdb58;
    }
    button {
      background: #b8860b;
      border: none;
      padding: 14px 0;
      border-radius: 14px;
      font-weight: 700;
      font-size: 17px;
      color: white;
      cursor: pointer;
      transition: background 0.4s, box-shadow 0.4s;
      box-shadow: 0 4px 12px rgba(184, 134, 11, 0.6);
      letter-spacing: 0.07em;
      user-select: none;
    }
    button:hover {
      background: #ffdb58;
      color: #6b4f00;
      box-shadow: 0 6px 20px rgba(255, 219, 88, 0.8);
    }
    .error {
      color: #cc0000;
      font-weight: 600;
      font-size: 0.9rem;
      height: 20px;
      min-height: 20px;
      user-select: none;
    }
    .welcome {
      margin-top: 10px;
      font-weight: 600;
      font-size: 1.15rem;
      color: #4b3b00;
      text-align: center;
      user-select: none;
      letter-spacing: 0.05em;
    }
    .logout-btn {
      margin-top: 20px;
      width: 100%;
      background: #cc3300;
      box-shadow: 0 4px 14px rgba(204, 51, 0, 0.8);
      user-select: none;
    }
    .logout-btn:hover {
      background: #ff6655;
      box-shadow: 0 6px 22px rgba(255, 102, 85, 0.9);
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(12px);}
      to {opacity: 1; transform: translateY(0);}
    }
    /* Игра */
    #game {
      display: none;
      flex-direction: column;
      gap: 20px;
      text-align: center;
    }
    #coins {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-shadow: 0 0 6px #ffd700;
      color: #b8860b;
      user-select: text;
    }
    #mine-btn {
      padding: 20px 0;
      font-size: 22px;
      border-radius: 20px;
      background: linear-gradient(45deg, #ffcc33, #b8860b);
      box-shadow: 0 6px 14px rgba(184,134,11,0.7);
      cursor: pointer;
      transition: background 0.3s;
      font-weight: 700;
      user-select: none;
      color: #4b3b00;
      border: none;
    }
    #mine-btn:hover {
      background: linear-gradient(45deg, #ffd54f, #ffb300);
      box-shadow: 0 8px 22px rgba(255, 213, 79, 0.9);
    }
    #upgrade-btn {
      background: #cfa93f;
      padding: 14px 0;
      font-weight: 700;
      font-size: 18px;
      border-radius: 14px;
      border: none;
      box-shadow: 0 4px 12px rgba(207, 169, 63, 0.7);
      cursor: pointer;
      transition: background 0.3s;
      color: #4b3b00;
      user-select: none;
    }
    #upgrade-btn:disabled {
      background: #e3d8a8;
      color: #999;
      cursor: default;
      box-shadow: none;
    }
    #upgrade-btn:hover:enabled {
      background: #d7c042;
      box-shadow: 0 6px 18px rgba(215, 192, 66, 0.9);
    }
    #error-game {
      color: #cc0000;
      font-weight: 600;
      font-size: 0.9rem;
      height: 20px;
      min-height: 20px;
      user-select: none;
      margin-top: -10px;
    }
    /* Рекламный баннер снизу */
    #ad-banner {
      position: fixed;
      bottom: 0;
      left: 0; right: 0;
      background: rgba(0,0,0,0.5);
      text-align: center;
      padding: 8px 0;
      z-index: 99999;
    }
    #ad-banner iframe {
      width: 70%;
      max-width: 468px;
      height: auto;
      border: none;
      overflow: hidden;
      margin: 0 auto;
    }
    #ad-close {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 5px #00000088;
      user-select: none;
    }
    #ad-close:hover {
      background: rgba(255, 255, 255, 1);
    }
    #ad-close svg {
      fill: #333;
      width: 14px;
      height: 14px;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Авторизация -->
    <div id="auth">
      <h1>Golden Mine</h1>
      <div class="tabs">
        <div class="tab active" data-tab="signup">Sign Up</div>
        <div class="tab" data-tab="signin">Sign In</div>
      </div>
      <!-- Регистрация -->
      <form id="signup-form" class="active">
        <input type="text" id="signup-nickname" placeholder="Никнейм (3–15 символов)" minlength="3" maxlength="15" required />
        <input type="email" id="signup-email" placeholder="Email" required />
        <input type="password" id="signup-password" placeholder="Пароль (6+ символов)" minlength="6" required />
        <div class="error" id="signup-error"></div>
        <button type="submit">Зарегистрироваться</button>
      </form>
      <!-- Вход -->
      <form id="signin-form">
        <input type="email" id="signin-email" placeholder="Email" required />
        <input type="password" id="signin-password" placeholder="Пароль" required />
        <div class="error" id="signin-error"></div>
        <button type="submit">Войти</button>
      </form>
    </div>

    <!-- Игра -->
    <div id="game">
      <h1>Добро пожаловать, <span id="player-name"></span>!</h1>
      <div id="coins">Золото: 0</div>
      <button id="mine-btn">Добыть золото</button>
      <button id="upgrade-btn" disabled>Улучшить добычу (стоимость: 10)</button>
      <div id="error-game"></div>
      <button class="logout-btn" id="logout-btn">Выйти</button>
    </div>
  </div>

  <!-- Рекламный баннер -->
  <div id="ad-banner">
    <label for="ad-close" id="ad-close" title="Закрыть рекламу">
      <svg viewBox="0 0 490 490" xmlns="http://www.w3.org/2000/svg">
        <polygon points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 489.292,457.678 277.331,245.004 489.292,32.337 "/>
      </svg>
    </label>
    <iframe data-aa="2406373" src="//acceptable.a-ads.com/2406373/?size=Adaptive" scrolling="no" title="advertisement"></iframe>
  </div>

  <!-- Firebase SDK и логика -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCXfzRrHa2t-y5TBJoipN0m_mv9bXjHmL8",
      authDomain: "golden-mine-e7d50.firebaseapp.com",
      databaseURL: "https://golden-mine-e7d50-default-rtdb.firebaseio.com",
      projectId: "golden-mine-e7d50",
      storageBucket: "golden-mine-e7d50.firebasestorage.app",
      messagingSenderId: "49056047000",
      appId: "1:49056047000:web:76e20efa45a0b8ffc415ed",
      measurementId: "G-MMD56ZP5YE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // DOM элементы
    const signupForm = document.getElementById('signup-form');
    const signinForm = document.getElementById('signin-form');
    const signupError = document.getElementById('signup-error');
    const signinError = document.getElementById('signin-error');
    const welcomeNameSpan = document.getElementById('player-name');
    const coinsDiv = document.getElementById('coins');
    const mineBtn = document.getElementById('mine-btn');
    const upgradeBtn = document.getElementById('upgrade-btn');
    const errorGame = document.getElementById('error-game');
    const logoutBtn = document.getElementById('logout-btn');
    const authDiv = document.getElementById('auth');
    const gameDiv = document.getElementById('game');
    const tabs = document.querySelectorAll('.tab');
    const signupNickname = document.getElementById('signup-nickname');

    // Переключение вкладок (рег и вход)
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        if (tab.dataset.tab === 'signup') {
          signupForm.classList.add('active');
          signinForm.classList.remove('active');
          signupError.textContent = '';
          signinError.textContent = '';
        } else {
          signupForm.classList.remove('active');
          signinForm.classList.add('active');
          signupError.textContent = '';
          signinError.textContent = '';
        }
      });
    });

    // Текущие данные игрока в памяти
    let currentUser = null;
    let coins = 0;
    let miningPower = 1;
    let upgradeCost = 10;

    // Функция обновления интерфейса
